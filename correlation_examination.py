import matplotlib.pyplot as plt
import numpy as  np
from scipy.stats import pearsonr, spearmanr
import statsmodels.api as sm
from statsmodels.nonparametric.smoothers_lowess import lowess

data = [
    ['12.sql', 0, 136.82766666666657],
    ['18.sql', 0, 116.71033333333337],
    ['16.sql', 1, 166.64466666666667],
    ['4.sql', 0, 0.02],
    ['7.sql', 0, 90.1653333333333],
    ['1.sql', 0, 943.5073333333333],
    ['10.sql', 0, 167.11066666666662],
    ['15.sql', 5, 420.69900000000007],
    ['22.sql', 0, 20.80966666666666],
    ['5.sql', 0, 89.51099999999997],
    ['19.sql', 0, 10.767333333333335],
    ['14.sql', 0, 5.3856666666666415],
    ['13.sql', 0, 79.74433333333324],
    ['2.sql', 6, 75.183],
    ['17.sql', 0, 22.474333333333373],
    ['9.sql', 14, 254.58300000000008],
    ['20.sql', 8, 538.3053333333334],
    ['11.sql', 10, 11.185333333333338],
    ['8.sql', 0, 193.9320000000001],
    ['3.sql', 3, 38.93966666666662],
    ['21.sql', 4, 90.78033333333337],
    ['6.sql', 0, 248.73599999999996],
    ['9b.sql', 12, 2261.392333333333],
    ['28c.sql', 9, 224.44799999999987],
    ['2d.sql', 0, 29.907],
    ['9c.sql', 10, 3005.7496666666666],
    ['5a.sql', 7, 58.64266666666666],
    ['29b.sql', 34, 2344.5963333333334],
    ['17f.sql', 0, 286.6826666666657],
    ['33b.sql', 24, 75.34733333333334],
    ['11d.sql', 8, 76.91833333333334],
    ['19a.sql', 18, 4450.2953333333335],
    ['21c.sql', 13, 6.316333333333333],
    ['25c.sql', 0, 609.5293333333339],
    ['2c.sql', 0, 27.311999999999994],
    ['10b.sql', 0, 15.571333333333333],
    ['31b.sql', 16, 265.7706666666666],
    ['33c.sql', 20, 134.84066666666666],
    ['23b.sql', 5, 6.371000000000009],
    ['2b.sql', 0, 21.68866666666666],
    ['14a.sql', 0, 37.661333333333346],
    ['7a.sql', 4, 38.00066666666669],
    ['16a.sql', 0, 12.84566666666666],
    ['11c.sql', 12, 78.04533333333333],
    ['8a.sql', 3, 164.36366666666663],
    ['2a.sql', 0, 22.74933333333335],
    ['12b.sql', 11, 0.18133333333333335],
    ['15d.sql', 20, 1408.3226666666667],
    ['15b.sql', 11, 5.5646666666666675],
    ['3c.sql', 11, 2905.333666666667],
    ['23a.sql', 5, 7.74133333333332],
    ['24b.sql', 2, 4.6766666666666685],
    ['12c.sql', 0, 117.96166666666666],
    ['27c.sql', 21, 10.158000000000001],
    ['18a.sql', 13, 22668.173],
    ['22a.sql', 0, 111.18533333333336],
    ['16c.sql', 0, 32.99966666666668],
    ['13b.sql', 10, 24.91933333333331],
    ['1c.sql', 3, 1.2046666666666666],
    ['16d.sql', 0, 66.925],
    ['4c.sql', 10, 1365.7600000000002],
    ['9d.sql', 0, 973.6283333333331],
    ['17e.sql', 0, 297.83733333333294],
    ['5c.sql', 0, 65.65366666666667],
    ['11b.sql', 13, 40.10366666666667],
    ['11a.sql', 16, 8.278333333333332],
    ['10c.sql', 15, 574.1596666666665],
    ['26b.sql', 16, 1023.686],
    ['26a.sql', 19, 14069.784999999998],
    ['21b.sql', 18, 8.104333333333333],
    ['31a.sql', 10, 9273.348666666667],
    ['27a.sql', 19, 56.839],
    ['20b.sql', 9, 37913.47066666667],
    ['14c.sql', 0, 158.7106666666667],
    ['18c.sql', 11, 635.894666666667],
    ['19c.sql', 16, 9701.852333333334],
    ['4a.sql', 10, 968.9139999999999],
    ['3a.sql', 11, 4909.857333333333],
    ['13d.sql', 0, 111.77366666666678],
    ['18b.sql', 7, 436.0366666666667],
    ['6a.sql', 0, 2.7863333333333338],
    ['24a.sql', 14, 127.55066666666664],
    ['26c.sql', 18, 54773.63766666667],
    ['22c.sql', 0, 863.9553333333333],
    ['1a.sql', 3, 1.12],
    ['30c.sql', 8, 1641.405],
    ['8d.sql', 12, 383.8816666666665],
    ['25a.sql', 0, 298.0376666666666],
    ['17d.sql', 5, 1021.0796666666671],
    ['22d.sql', 0, 434.9176666666667],
    ['8c.sql', 12, 3222.585333333333],
    ['16b.sql', 0, 953.64],
    ['28a.sql', 15, 1212.4323333333334],
    ['21a.sql', 18, 60.55599999999999],
    ['3b.sql', 6, 1453.731],
    ['31c.sql', 13, 9113.560333333333],
    ['15a.sql', 16, 1126.31],
    ['17c.sql', 5, 473.28933333333407],
    ['8b.sql', 8, 67.89066666666668],
    ['12a.sql', 0, 59.74099999999999],
    ['25b.sql', 9, 209.64300000000003],
    ['32b.sql', 3, 6.5103333333333255],
    ['32a.sql', 3, 5.005666666666666],
    ['20c.sql', 9, 38854.63333333334],
    ['27b.sql', 23, 68.86099999999999],
    ['15c.sql', 20, 1999.834],
    ['17a.sql', 0, 361.5526666666671],
    ['4b.sql', 9, 31.455666666666662],
    ['19b.sql', 22, 1843.6153333333332],
    ['7b.sql', 4, 54.959],
    ['6b.sql', 0, 45.362],
    ['7c.sql', 15, 8831.974333333334],
    ['33a.sql', 7, 9.426666666666666],
    ['1d.sql', 0, 0.082],
    ['1b.sql', 0, 0.025333333333333347],
    ['28b.sql', 13, 2004.8329999999999],
    ['6c.sql', 0, 2.9426666666666663],
    ['23c.sql', 5, 21.65366666666667],
    ['14b.sql', 5, 7.821333333333333],
    ['29a.sql', 35, 114.44633333333333],
    ['6f.sql', 0, 171.869],
    ['17b.sql', 4, 110.1843333333339],
    ['30a.sql', 0, 92.01100000000001],
    ['22b.sql', 0, 16.783666666666686],
    ['29c.sql', 35, 2847.461],
    ['13a.sql', 0, 32.33399999999983],
    ['6d.sql', 0, 190.12866666666682],
    ['5b.sql', 5, 40.11466666666667],
    ['9a.sql', 14, 3170.308333333334],
    ['6e.sql', 0, 3.7023333333333333],
    ['10a.sql', 4, 42.93133333333333],
    ['30b.sql', 4, 4.852666666666664],
    ['20a.sql', 9, 81162.56866666666],
    ['13c.sql', 10, 72.56633333333332],
    ['query91.sql', 3, 1.4816666666666667],
    ['query88.sql', 64, 1328.4736666666668],
    ['query98.sql', 4, 5.700000000000027],
    ['query85.sql', 18, 25.708999999999993],
    ['query89.sql', 1, 85.83933333333333],
    ['query78.sql', 23, 905.5453333333335],
    ['query75.sql', 4, 233.06466666666665],
    ['query20.sql', 4, 3.549000000000001],
    ['query54.sql', 1, 6.719666666666666],
    ['query40.sql', 5, 17.697000000000003],
    ['query16.sql', 1, 28.144666666666655],
    ['query97.sql', 6, 282.47766666666666],
    ['query96.sql', 6, 140.02533333333332],
    ['query80.sql', 22, 51.52933333333332],
    ['query35.sql', 0, 58.49966666666668],
    ['query9.sql', 0, 25.59433333333334],
    ['query64.sql', 19, 65.4343333333333],
    ['query21.sql', 5, 948.07],
    ['query83.sql', 0, 9.902],
    ['query17.sql', 2, 37.81333333333331],
    ['query42.sql', 0, 69.01833333333333],
    ['query82.sql', 3, 3.1349999999999993],
    ['query61.sql', 8, 392.98133333333334],
    ['query71.sql', 0, 62.33066666666667],
    ['query18.sql', 2, 141.55233333333334],
    ['query59.sql', 1, 1094.9883333333332],
    ['query31.sql', 2, 4225.123333333334],
    ['query67.sql', 3, 1271.9033333333334],
    ['query25.sql', 2, 43.303000000000004],
    ['query57.sql', 1, 241.77800000000002],
    ['query32.sql', 1, 1.9783333333333328],
    ['query94.sql', 1, 32.510666666666665],
    ['query7.sql', 0, 105.819],
    ['query95.sql', 10, 12331.265333333335],
    ['query81.sql', 0, 10119.972],
    ['query10.sql', 0, 7.4020000000000055],
    ['query51.sql', 0, 81.55999999999995],
    ['query14.sql', 4, 2459.218333333334],
    ['query3.sql', 1, 0.6916666666666664],
    ['query30.sql', 0, 2111.1096666666667],
    ['query19.sql', 0, 2.6793333333333322],
    ['query56.sql', 8, 505.337],
    ['query45.sql', 12, 17.037666666666667],
    ['query33.sql', 10, 285.269],
    ['query49.sql', 10, 129.686],
    ['query6.sql', 0, 11401.979666666666],
    ['query79.sql', 5, 44.163333333333334],
    ['query5.sql', 16, 872.4763333333334],
    ['query90.sql', 0, 17.367],
    ['query47.sql', 1, 774.207],
    ['query99.sql', 9, 160.834],
    ['query29.sql', 2, 13.450999999999999],
    ['query37.sql', 2, 0.23866666666666672],
    ['query23.sql', 12, 643.5290000000001],
    ['query34.sql', 6, 36.90733333333333],
    ['query69.sql', 4, 0.016999999999999998],
    ['query60.sql', 8, 1765.0883333333331],
    ['query46.sql', 5, 52.11900000000001],
    ['query26.sql', 4, 82.00333333333332],
    ['query63.sql', 2, 17.65166666666666],
    ['query76.sql', 5, 110.80966666666667],
    ['query15.sql', 0, 6.699666666666663],
    ['query77.sql', 21, 56.03566666666669],
    ['query70.sql', 13, 812.3096666666667],
    ['query58.sql', 0, 8.328333333333333],
    ['query27.sql', 0, 66.253],
    ['query92.sql', 1, 8.617000000000004],
    ['query24.sql', 1, 12.947333333333338],
    ['query22.sql', 10, 2937.7090000000003],
    ['query66.sql', 0, 53.95733333333334],
    ['query55.sql', 0, 58.058333333333316],
    ['query50.sql', 1, 5.776666666666668],
    ['query72.sql', 1, 953.2433333333338],
    ['query43.sql', 6, 3538.9086666666662],
    ['query73.sql', 10, 28.327333333333325],
    ['query65.sql', 8, 200.2066666666667],
    ['query53.sql', 2, 16.831999999999994],
    ['query13.sql', 18, 602.303],
    ['query28.sql', 0, 650.335],
    ['query68.sql', 8, 32.73166666666668],
    ['query87.sql', 3, 191.71433333333331],
    ['query86.sql', 0, 34.044000000000004],
    ['query48.sql', 12, 502.71866666666665],
    ['query62.sql', 8, 137.58900000000003],
    ['query36.sql', 1, 256.02866666666665],
    ['query44.sql', 0, 267.39799999999997],
    ['query84.sql', 6, 5.028000000000001],
    ['query52.sql', 0, 47.32700000000002],
    ['query8.sql', 2, 43.85333333333333],
    ['query38.sql', 3, 212.08866666666665],
    ['query39.sql', 0, 8.23833333333323],
    ['query12.sql', 1, 11.13433333333333],
    ['query41.sql', 0, 95.80599999999998],
    ['query2.sql', 0, 413.0443333333333],
    ['query93.sql', 0, 0.015333333333333332]
]

xs = [d[1] for d in data]
ys = [d[2] for d in data]

# Remove outliers
xs = np.array(xs)
ys = np.array(ys)
mean_x = np.mean(xs)
mean_y = np.mean(ys)
std_x = np.std(xs)
std_y = np.std(ys)

xxs = []
yys = []
for i in range(len(ys)):
    if np.abs(ys[i] - mean_y) < 2 * std_y:
        xxs.append(xs[i])
        yys.append(ys[i])

xs = np.array(xxs)
ys = np.array(yys)

# Calculate Pearson's correlation
pearson_corr, _ = pearsonr(xs, ys)
print('Pearsons correlation: %.3f' % pearson_corr)

# Calculate Spearman's correlation
spearman_corr, _ = spearmanr(xs, ys)
print('Spearman correlation: %.3f' % spearman_corr)

# Linear Regression Analysis
X = sm.add_constant(xs)
model = sm.OLS(ys, X).fit()
print(f"Linear Regression: {model.summary()}")

# Line of best fit
m, b = np.polyfit(xs, ys, 1)

# LOWESS curve
lowess_curve = lowess(ys, xs, frac=0.3)

# Plotting
plt.figure(figsize=(10, 6))
plt.scatter(xs, ys, label='Data Points')
plt.plot(xs, m*xs + b, color='red', label='Line of Best Fit')
plt.plot(lowess_curve[:, 0], lowess_curve[:, 1], color='green', label='LOWESS Curve')
plt.xlabel("Tree Edit Distance")
plt.ylabel("Time Execution Difference (ms)")
plt.legend()
plt.savefig("Non_Linear_Fit.png")
plt.show()